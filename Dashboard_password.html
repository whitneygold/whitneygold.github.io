<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exam Password</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0;}
  nav{background:#006400; padding:15px; color:#fff;}
  .nav-links { list-style:none; display:flex; gap:20px;}
  .nav-links a {color:white; text-decoration:none;}
  .container{max-width:900px; margin:auto; padding:20px;}
  header{text-align:center; padding:20px; background:#008000; color:white;}
  .welcome-message{ text-align:center; margin:20px 0; background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  #student-image{ width:80px; height:80px; border-radius:50%; margin-bottom:10px;}
  .exam-section{ background:white; padding:20px; margin:10px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
  .btn{ background:#008000; color:white; border:none; padding:10px 20px; margin-top:15px; cursor:pointer; border-radius:5px;}
  .btn:hover{ background:#004d00;}
</style>
</head>
<body>
<nav>
  <ul class="nav-links">
    <li><a href="#"><i class="fas fa-home"></i> Home</a></li>
    <li><a href="#"><i class="fas fa-info-circle"></i> About</a></li>
    <li><a href="#"><i class="fas fa-question-circle"></i> Help</a></li>
    <li><a href="home.html"><i class="fas fa-sign-out-alt"></i> Sign Out</a></li>
  </ul>
</nav>

<div class="container">
  <header>
    <h2>2025/2026 FIRST TERM COMPUTER BASED TEST EXAMINATION</h2>
  </header>

  <div class="welcome-message">
    <img id="student-image" src="img/default.jpg" alt="Profile Picture">
    <h3 id="welcome-msg">WELCOME: Guest</h3>
  </div>

  <div class="exam-section">
    <h3 id="exam-title">Loading Exam Info...</h3>
    <form id="exam-password-form">
      <center>
        <label>Enter Exam Password:</label>
        <input type="password" id="exam-password" required placeholder="Exam Password">
      </center>
      <center>
        <button class="btn" type="submit">Start Exam</button>
      </center>
    </form>
  </div>
</div>

<script>
const user = JSON.parse(localStorage.getItem("currentUser")) || {username:"Guest", image:"img/default.jpg"};
document.getElementById("student-image").src = user.image;
document.getElementById("welcome-msg").textContent = `WELCOME: ${user.username}`;

const selectedClass = localStorage.getItem("selectedClass") || 'Class';
const selectedSubject = localStorage.getItem("selectedSubject") || 'Subject';
const selectedExamType = localStorage.getItem("selectedExamType") || 'Exam';

document.getElementById("exam-title").textContent = `${selectedClass} - ${selectedSubject} - ${selectedExamType} exam password`;

document.getElementById("exam-password-form").addEventListener("submit", function(e){
  e.preventDefault();
  const enteredPassword = document.getElementById("exam-password").value.trim();
  if(!enteredPassword){ alert("Please enter the exam password."); return; }

  const fileName = `database/${selectedClass.toLowerCase()}_exam_passwords.json`;

  fetch(fileName)
    .then(res => res.json())
    .then(data => {
      const record = data.find(r => r.subject.toLowerCase() === selectedSubject.toLowerCase());
      if(!record){ alert(`Subject "${selectedSubject}" not found for ${selectedClass}.`); return; }
      if(record.password === enteredPassword){
        localStorage.setItem("exam_password", enteredPassword);
        const redirectUrl = selectedExamType.toLowerCase() === "objectives" ? 
          "exam.html" : 
          "class_subject_theory_answer_booklet.html";
        window.location.href = redirectUrl;
      } else { alert("Incorrect exam password!"); }
    })
    .catch(err=>{ console.error(err); alert("Error loading password data."); });
});
</script>
</body>
</html>
